<%var countFields = 1;%>
<%var fields = [];%>
<%_(model.createEntity().attributes).each(function(attr, key){%>
    <%if(view.options.exclude && _(view.options.exclude).contains(key)) return;
    fields.push(key);
    countFields++;%>
<%});%>
<table class="table table-striped table-bordered box">
    <thead>
        <tr>
            <th colspan="<%=countFields%>"><%=view.options.title%></th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <%_(model.createEntity().attributes).each(function(attr, key){%>
                <%if(view.options.exclude && _(view.options.exclude).contains(key)) return;%>
                <th><%if(view.options.translations && view.options.translations[key]){%><%=view.options.translations[key]%><%}else{%><%=key%><%}%></th>
            <%});%>
            <th width="140">Действия</th>
        </tr>
        <%model.each(function(elem){%>
        <tr>
            <%_(fields).each(function(key){%>
                <%var attr = elem.get(key);%>
                <td>
                    <%if(view.options.fields && view.options.fields[key]){%>
                        <%if(view.options.fields[key].getter){
                            attr = elem[view.options.fields[key].getter]();
                        };%>
                        <%switch(view.options.fields[key].type){
                            case "enum":%>
                                <%=view.options.fields[key].values[attr]%>
                            <%break;
                            default:%>
                                <%=attr%>
                            <%break;
                        }%>
                    <%}else{%>
                        <%=attr%>
                    <%}%>
                </td>
            <%});%>
            <td>
                <a class="j-nav button" href="<%=elem.linkTo('show')%>"><i class="icon-eye-open"></i></a>
                <a class="j-nav button blue" href="<%=elem.linkTo('edit')%>"><i class="icon-pencil"></i></a>
                <button class="j-remove-occupation button red" data-id="<%=elem.id%>"><i class="icon-trash"></i></button>
            </td>
        </tr>
        <%});%>
    </tbody>
    <tfoot>
        <tr>
            <td colspan="<%=countFields%>">
                <a href="<%=model.linkTo('new')%>" class="j-nav j-new-occupation button blue"><i class="icon-plus"></i> Добавить</a>
            </td>
        </tr>
    </tfoot>
</table>